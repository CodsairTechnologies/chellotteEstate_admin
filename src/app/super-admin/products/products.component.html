<div class="p-3">
    <div class="row first-row mb-2">
        <!-- Breadcrumb -->
        <div class="col">
            <div class="breadcrumb">
                <span class="home-icon"><i class="bi bi-house-fill"></i></span>
                <a href="/super-admin/products" class="breadcrumb-item">Products</a>
            </div>
        </div>

        <!-- Add Button -->
        <div class="col">
            <div class="justify-content-end d-flex">
                <button pButton type="button" label="+Add" class="btn button"
                    (click)="openProductModal(false)"></button>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="card table-card mb-3">
        <app-table [arrList]="arrList" [arrColumns]="arrColumns" [blnForDelete]="true" [blnHasSingleview]="true"
            [blnNoEdit]="true" (objPresentationEvent)="eventFromTable($event)">
        </app-table>
    </div>
</div>

<!-- Add/Edit Modal -->
<p-dialog [(visible)]="OpenModal" [modal]="true" [style]="{ width: '55vw' }" [baseZIndex]="9000" [draggable]="false"
    [resizable]="false" [header]="modalHeader">

    <div class="modal-body">
        <form [formGroup]="ProductForm">

            <!-- Row 1: Product ID, Title, Price -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Product ID</label>
                    <input type="text" class="form-control" formControlName="productID"
                        placeholder="Enter product ID" />
                    <div class="text-danger mt-1"
                        *ngIf="ProductForm.get('productID')?.touched && ProductForm.get('productID')?.invalid">
                        Product ID is required
                    </div>
                </div>

                <!-- Title -->
                <div class="col-md-4">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-control" formControlName="title" placeholder="Enter product title" />
                    <div class="text-danger mt-1"
                        *ngIf="ProductForm.get('title')?.touched && ProductForm.get('title')?.invalid">
                        Title is required
                    </div>
                </div>

                <!-- Price -->
                <div class="col-md-4">
                    <label class="form-label">Price</label>
                    <input type="number" class="form-control" formControlName="price" placeholder="Enter price" />
                    <div class="text-danger mt-1"
                        *ngIf="ProductForm.get('price')?.touched && ProductForm.get('price')?.invalid">
                        <span *ngIf="ProductForm.get('price')?.errors?.['required']">Price is required</span>
                        <span *ngIf="ProductForm.get('price')?.errors?.['min']">Price must be greater than 0</span>
                    </div>
                </div>
            </div>

            <!-- Row 2: Description -->
            <div class="row mb-3">
                <div class="col-12">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" formControlName="description"
                        placeholder="Enter product description"></textarea>
                    <div class="text-danger mt-1"
                        *ngIf="ProductForm.get('description')?.touched && ProductForm.get('description')?.invalid">
                        Description is required
                    </div>
                </div>
            </div>

            <!-- Row 3: Availability, Brand Name, Is Featured -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Availability</label>
                    <select class="form-control" formControlName="availability">
                        <option value="">Select Availability</option>
                        <option value="instock">In Stock</option>
                        <option value="outofstock">Out of Stock</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Brand Name</label>
                    <input type="text" class="form-control" formControlName="brand_name"
                        placeholder="Enter brand name" />
                    <div class="text-danger mt-1"
                        *ngIf="ProductForm.get('brand_name')?.touched && ProductForm.get('brand_name')?.invalid">
                        Brand Name is required
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-center">
                    <div class="form-check mt-2">
                        <input type="checkbox" class="form-check-input" formControlName="is_featured"
                            id="is_featured" />
                        <label for="is_featured" class="form-check-label">Is Featured?</label>
                    </div>
                </div>
            </div>

            <!-- Images: Cover, Background, Card Icon in single row -->
            <div class="row mb-3">
                <!-- Cover Image -->
                <div class="col-md-4">
                    <label>Cover Image</label>
                    <div class="img-card card mt-2">
                        <div *ngIf="!showImageBox.cover_image">
                            <button type="button" class="btn uploadbtn" (click)="coverInput.click()">Choose
                                File</button>
                            <input type="file" class="d-none" #coverInput (change)="onFileUpload($event,'cover_image')"
                                accept="image/*">
                        </div>
                        <div *ngIf="showImageBox.cover_image" class="img-div position-relative w-100">
                            <img [src]="imagePreview.cover_image" class="img-preview img-fluid"
                                style="width: 100%; height: 150px; object-fit: cover;" />
                            <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                                style="cursor:pointer;" (click)="clearImage('cover_image')"></i>
                        </div>
                    </div>
                </div>

                <!-- Background Image -->
                <div class="col-md-4">
                    <label>Background Image</label>
                    <div class="img-card card mt-2">
                        <div *ngIf="!showImageBox.background_image">
                            <button type="button" class="btn uploadbtn" (click)="bgInput.click()">Choose File</button>
                            <input type="file" class="d-none" #bgInput
                                (change)="onFileUpload($event,'background_image')" accept="image/*">
                        </div>
                        <div *ngIf="showImageBox.background_image" class="img-div position-relative w-100">
                            <img [src]="imagePreview.background_image" class="img-preview img-fluid"
                                style="width: 100%; height: 150px; object-fit: cover;" />
                            <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                                style="cursor:pointer;" (click)="clearImage('background_image')"></i>
                        </div>
                    </div>
                </div>

                <!-- Card Icon -->
                <div class="col-md-4">
                    <label>Card Icon</label>
                    <div class="img-card card mt-2">
                        <div *ngIf="!showImageBox.card_icon">
                            <button type="button" class="btn uploadbtn" (click)="iconInput.click()">Choose File</button>
                            <input type="file" class="d-none" #iconInput (change)="onFileUpload($event,'card_icon')"
                                accept="image/*">
                        </div>
                        <div *ngIf="showImageBox.card_icon" class="img-div position-relative w-100">
                            <img [src]="imagePreview.card_icon" class="img-preview img-fluid"
                                style="width: 100%; height: 150px; object-fit: cover;" />
                            <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                                style="cursor:pointer;" (click)="clearImage('card_icon')"></i>
                        </div>
                    </div>
                </div>
            </div>


        </form>
    </div>

    <ng-template pTemplate="footer">
        <button type="submit" pButton (click)="handleProductOperation()" class="submit-btn">Save</button>
    </ng-template>
</p-dialog>


<!-- Single View Modal -->
<p-dialog [(visible)]="displaySingleViewModal" header="Product Details" [modal]="true" [style]="{ width: '55vw' }"
    [closable]="true" [dismissableMask]="true">

    <div *ngIf="selectedProduct" class="singleview-body p-3">

        <!-- Row 1: Product ID, Title, Price -->
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label">Product ID</label>
                <p class="form-control-plaintext">{{ selectedProduct.productID }}</p>
            </div>
            <div class="col-md-4">
                <label class="form-label">Title</label>
                <p class="form-control-plaintext">{{ selectedProduct.title }}</p>
            </div>
            <div class="col-md-4">
                <label class="form-label">Price</label>
                <p class="form-control-plaintext">{{ selectedProduct.price }}</p>
            </div>
        </div>

        <!-- Row 2: Description -->
        <div class="row mb-3">
            <div class="col-12">
                <label class="form-label">Description</label>
                <p class="form-control-plaintext">{{ selectedProduct.description }}</p>
            </div>
        </div>

        <!-- Row 3: Availability, Brand Name, Is Featured -->
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label">Availability</label>
                <p class="form-control-plaintext">{{ selectedProduct.availability }}</p>
            </div>
            <div class="col-md-4">
                <label class="form-label">Brand Name</label>
                <p class="form-control-plaintext">{{ selectedProduct.brand_name }}</p>
            </div>
            <div class="col-md-4 d-flex align-items-center">
                <label class="form-label me-2">Featured</label>
                <p class="form-control-plaintext">{{ selectedProduct.is_featured ? 'Yes' : 'No' }}</p>
            </div>
        </div>

        <!-- Images: Cover, Background, Card Icon in single row -->
        <div class="row mb-3">
            <!-- Cover Image -->
            <div class="col-md-4">
                <label>Cover Image</label>
                <div class="img-card card mt-2">
                    <img *ngIf="selectedProduct.cover_image" [src]="getImageUrl(selectedProduct.cover_image)"
                        class="img-preview img-fluid" style="width: 100%; height: 150px; object-fit: cover;" />
                </div>
            </div>

            <!-- Background Image -->
            <div class="col-md-4">
                <label>Background Image</label>
                <div class="img-card card mt-2">
                    <img *ngIf="selectedProduct.background_image" [src]="getImageUrl(selectedProduct.background_image)"
                        class="img-preview img-fluid" style="width: 100%; height: 150px; object-fit: cover;" />
                </div>
            </div>

            <!-- Card Icon -->
            <div class="col-md-4">
                <label>Card Icon</label>
                <div class="img-card card mt-2">
                    <img *ngIf="selectedProduct.card_icon" [src]="getImageUrl(selectedProduct.card_icon)"
                        class="img-preview img-fluid" style="width: 100%; height: 150px; object-fit: cover;" />
                </div>
            </div>
        </div>


    </div>
</p-dialog>


<!-- Delete Modal -->
<p-dialog [(visible)]="deleteModal" [modal]="true" [style]="{ width: '35vw' }" [baseZIndex]="10000" [draggable]="false"
    [resizable]="false">
    <ng-template pTemplate="header">
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle"></i>
            <span>Delete Product</span>
        </div>
    </ng-template>

    <div>
        <p class="justify-content-center d-flex mt-3 delete-para">
            Are you sure you want to delete this Product?
        </p>
    </div>

    <ng-template pTemplate="footer">
        <div class="justify-content-center d-flex">
            <button type="button" pButton class="close-btn" (click)="deleteModal = false">Close</button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button type="button" pButton class="delete-btn" (click)="deleteFn()">Delete</button>
        </div>
    </ng-template>
</p-dialog>

<div *ngIf="Loader" class="spinner-container">
    <div class="spinner"></div>
</div>