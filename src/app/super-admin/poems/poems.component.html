<div class="p-3">
    <div class="row  first-row mb-2">
        <!-- breadcrumbs -->
        <div class="col">
            <div class="breadcrumb">
                <span class="home-icon"><i class="bi bi-house-fill"></i></span>
                <!-- <a href="/super-admin/Dashboard" class="breadcrumb-item">Dashboard</a>
                <span class="arrow-icon"><i class="bi bi-caret-right-fill"></i></span> -->
                <a href="/super-admin/listpoems" class="breadcrumb-item">Poem</a>

                <span class="arrow-icon"><i class="bi bi-caret-right-fill"></i></span>
                <a href="/super-admin/BookReviewstories" class="breadcrumb-item">{{ isEditMode ? 'Edit Poem' :
                    'Add Poem' }} </a>
            </div>
        </div>
        <!-- breadcrumbs -->
    </div>

    <div class="card table-card mb-3 p-4 m-4 border rounded shadow-sm bg-white">
        <form [formGroup]="PoemForm">

            <!-- === Banner Image Section === -->
            <div class="border rounded p-3 mb-4 bg-light">
                <h6 class="section-title mb-3">Banner Details</h6>

                <!-- Banner Title -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Banner Title </label>
                    <input type="text" class="form-control" formControlName="bannerTitle"
                        placeholder="Enter banner title">
                    <!-- <div *ngIf="PoemForm.get('bannerTitle')?.invalid && PoemForm.get('bannerTitle')?.touched">
                        <p class="error-msg2">Banner title is required!</p>
                    </div> -->
                </div>

                <!-- Banner Image -->
                <div class="mb-3 w-50 position-relative">
                    <label class="form-label fw-semibold">Banner Image <span class="required">*</span></label>

                    <!-- Upload card -->
                    <div class="border rounded overflow-hidden" style="height: 200px; cursor: pointer;"
                        (click)="bannerInput.click()">

                        <!-- Preview -->
                        <img *ngIf="showBannerImgBox" [src]="bannerPreview"
                            class="w-100 h-100 rounded"  style="object-fit: contain;" />

                        <!-- Placeholder / instructions -->
                        <div *ngIf="!showBannerImgBox"
                            class="d-flex flex-column justify-content-center align-items-center h-100 text-muted">
                            <i class="bi bi-upload display-4"></i>
                            <p class="mb-0 small">Upload banner (Max: 5MB, Min: 1280x480, 16:6)</p>
                        </div>

                        <!-- Hidden file input -->
                        <input type="file" class="d-none" (change)="onBannerUpload($event)" #bannerInput
                            accept="image/*" />
                    </div>

                    <!-- Remove button -->
                    <i *ngIf="showBannerImgBox" class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                        style="cursor:pointer; font-size:1.5rem;" (click)="clearBannerImage()"></i>

                    <!-- Validation message -->
                    <div class="mt-2"
                        *ngIf="PoemForm.get('bannerImage')?.invalid && PoemForm.get('bannerImage')?.touched && !showBannerImgBox">
                        <p class="error-msg2">Banner image is required!</p>
                    </div>
                </div>


            </div>

            <!-- === Author Details Section === -->
            <div class="border rounded p-3 mb-4 bg-light">
                <h6 class="section-title mb-3">Author Details </h6>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-semibold">Author Name <span class="required">*</span></label>
                        <input type="text" class="form-control" formControlName="authorName"
                            placeholder="Enter author's name">
                        <div *ngIf="PoemForm.get('authorName')?.invalid && PoemForm.get('authorName')?.touched">
                            <p class="error-msg2">Author name is required!</p>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-semibold">Designation </label>
                        <input type="text" class="form-control" formControlName="designation"
                            placeholder="Poet, Writer, etc.">
                        <div *ngIf="PoemForm.get('designation')?.invalid && PoemForm.get('designation')?.touched">
                            <p class="error-msg2">Designation is required!</p>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">About Author</label>
                    <textarea rows="3" class="form-control" formControlName="aboutAuthor"
                        placeholder="Write something about the author..."></textarea>
                    <!-- <div *ngIf="PoemForm.get('aboutAuthor')?.invalid && PoemForm.get('aboutAuthor')?.touched">
                        <p class="error-msg2">About Author is required!</p>
                    </div> -->
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3 position-relative">
                    <label class="form-label fw-semibold">Author Image</label>

                    <div class="border rounded overflow-hidden text-center position-relative"
                        style="width: 200px; height: 200px; cursor: pointer;" (click)="authorImgInput.click()"
                        (dragover)="onAuthorDragOver($event)" (dragleave)="onAuthorDragLeave($event)"
                        (drop)="onAuthorFileDrop($event)" [class.dragover]="isAuthorDragOver">

                        <!-- Preview -->
                        <img *ngIf="showAuthorImgBox" [src]="authorImgPreview"
                            class="w-100 h-100 object-fit-contain rounded bg-light" />

                        <!-- Placeholder / instructions -->
                        <div *ngIf="!showAuthorImgBox"
                            class="d-flex flex-column justify-content-center align-items-center h-100 text-muted text-center">
                            <i class="bi bi-upload display-4 mb-2"></i>
                            <p class="mb-0 small">
                                Drag & drop or click to upload
                            </p>
                        </div>

                        <!-- Hidden file input -->
                        <input type="file" class="d-none" (change)="onAuthorImageUpload($event)" #authorImgInput
                            accept="image/*" />

                        <!-- Remove button -->
                        <i *ngIf="showAuthorImgBox"
                            class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                            style="cursor:pointer; font-size:1.5rem;" (click)="clearAuthorImage()"></i>
                    </div>
                </div>
                </div>

            </div>

            <!-- === Poem Content Section === -->
            <div class="border rounded p-3 mb-3 bg-light">
                <h6 class="section-title mb-3">Poem Details</h6>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Poem Title <span class="required">*</span></label>
                    <input type="text" class="form-control" formControlName="poemTitle" placeholder="Enter poem title">
                    <div *ngIf="PoemForm.get('poemTitle')?.invalid && PoemForm.get('poemTitle')?.touched">
                        <p class="error-msg2">Poem title is required!</p>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Poem Content <span class="required">*</span></label>
                    <div class="quill-wrapper" style="height: 400px; width: 100%;">
                        <quill-editor formControlName="poemContent" [style]="{height: '100%', width: '100%'}"
                            theme="snow"></quill-editor>
                    </div>
                    <div *ngIf="PoemForm.get('poemContent')?.invalid && PoemForm.get('poemContent')?.touched">
                        <p class="error-msg2">Poem content is required!</p>
                    </div>
                </div>
            </div>

            <!-- Book CoverImage -->
            <!-- <div class="mb-3">
                <label class="form-label fw-semibold">Book Cover Image <span class="required">*</span></label>
                <div class="img-card card p-3" style="width: 200px; height: 220px;">

                    <div *ngIf="!showStoryImgBox">
                        <button type="button" class="btn btn-outline-secondary w-100"
                            (click)="storyImgInput.click()">Choose Image</button>
                        <input type="file" class="d-none" (change)="onStoryImageUpload($event)" #storyImgInput
                            accept="image/*" />
                    </div>
                    <div *ngIf="showStoryImgBox" class="position-relative w-100 h-100">
                        <img *ngIf="storyFileType.startsWith('image/')" [src]="storyImgPreview"
                            class="img-preview img-fluid rounded"
                            style="width: 100%; height: 100%; object-fit: contain;" />
                        <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                            (click)="clearStoryImage()" style="cursor: pointer;"></i>
                    </div>
                </div>

                <div
                    *ngIf="PoemForm.get('storyImage')?.invalid && PoemForm.get('storyImage')?.touched && !showStoryImgBox">
                    <p class="error-msg2">Poem Cover image is required!</p>
                </div>
            </div> -->
        </form>

        <div class="text-end mt-3">
            <button type="button" class="btn save-btn" (click)="handlePoemSubmit()">Save</button>
        </div>
    </div>
</div>

<div *ngIf="Loader" class="spinner-container">
    <div class="spinner"></div>
</div>