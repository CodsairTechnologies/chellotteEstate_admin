<div class="p-3">
    <div class="row  first-row mb-2">
        <!-- breadcrumbs -->
        <div class="col">
            <div class="breadcrumb">
                <span class="home-icon"><i class="bi bi-house-fill"></i></span>
                <a href="/super-admin/listbookreviews" class="breadcrumb-item">Book Review</a>
                <span class="arrow-icon"><i class="bi bi-caret-right-fill"></i></span>
                <a href="/super-admin/bookreviews" class="breadcrumb-item">{{ isEditMode ? 'Edit Book Reviews' :
                    'Add Book Reviews' }} </a>
            </div>
        </div>
        <!-- breadcrumbs -->
    </div>

    <div class="card table-card mb-3 p-4 m-4 border rounded shadow-sm bg-white">
        <form [formGroup]="BookReviewsForm">

            <!-- === Author Details Section === -->
            <div class="border rounded p-3 mb-4 bg-light">
                <h6 class="section-title mb-3">Author Details</h6>
                <div class="row">


                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-semibold">Author Name <span class="required">*</span></label>
                        <input type="text" class="form-control" formControlName="authorName"
                            placeholder="Enter author's name">
                        <div
                            *ngIf="BookReviewsForm.get('authorName')?.invalid && BookReviewsForm.get('authorName')?.touched">
                            <p class="error-msg2">Author name is required!</p>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-semibold">Designation </label>
                        <input type="text" class="form-control" formControlName="designation"
                            placeholder="Writer, Poet, etc.">
                        <!-- <div
                            *ngIf="BookReviewsForm.get('designation')?.invalid && BookReviewsForm.get('designation')?.touched">
                            <p class="error-msg2">Designation is required!</p>
                        </div> -->
                    </div>

                </div>

                <div class="row">
                    <div class="col-12 mb-3">
                        <label class="form-label fw-semibold">About Author </label>
                        <textarea rows="3" class="form-control" formControlName="aboutAuthor"
                            placeholder="Write something about the author..."></textarea>
                        <!-- <div
                            *ngIf="BookReviewsForm.get('aboutAuthor')?.invalid && BookReviewsForm.get('aboutAuthor')?.touched">
                            <p class="error-msg2">About Author is required!</p>
                        </div> -->
                    </div>
                </div>

                <div class="col-md-4 mb-3 position-relative">
                    <label class="form-label fw-semibold">Author Image</label>

                    <div class="border rounded overflow-hidden text-center position-relative"
                        style="width: 200px; height: 200px; cursor: pointer;" (click)="authorImgInput.click()"
                        (dragover)="onAuthorDragOver($event)" (dragleave)="onAuthorDragLeave($event)"
                        (drop)="onAuthorFileDrop($event)" [class.dragover]="isAuthorDragOver">

                        <!-- Preview -->
                        <img *ngIf="showAuthorImgBox" [src]="authorImgPreview"
                            class="w-100 h-100 object-fit-contain rounded bg-light" />

                        <!-- Placeholder / instructions -->
                        <div *ngIf="!showAuthorImgBox"
                            class="d-flex flex-column justify-content-center align-items-center h-100 text-muted text-center">
                            <i class="bi bi-upload display-4 mb-2"></i>
                            <p class="mb-0 small">
                                Drag & drop or click to upload
                            </p>
                        </div>

                        <!-- Hidden file input -->
                        <input type="file" class="d-none" (change)="onAuthorImageUpload($event)" #authorImgInput
                            accept="image/*" />

                        <!-- Remove button -->
                        <i *ngIf="showAuthorImgBox"
                            class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                            style="cursor:pointer; font-size:1.5rem;" (click)="clearAuthorImage()"></i>
                    </div>
                </div>





            </div>



            <!-- === BookReview Story Details Section === -->
            <div class="border rounded p-3 mb-3 bg-light">
                <h6 class="section-title mb-3">BookReview Details</h6>

                <!-- Cover Image Upload -->
                <div class="mb-3 w-75 position-relative">
                    <label class="form-label fw-semibold">Banner Image <span class="required">*</span></label>

                    <!-- Upload card -->
                    <div class="border rounded overflow-hidden" style="height: 200px; cursor: pointer;"
                        (click)="coverFileInput.click()">

                        <!-- Preview -->
                        <img *ngIf="showCoverBox" [src]="coverPreview" class="w-100 h-100"
                            style="object-fit: contain;" />

                        <!-- Placeholder / instructions -->
                        <div *ngIf="!showCoverBox"
                            class="d-flex flex-column justify-content-center align-items-center h-100 text-muted">
                            <i class="bi bi-upload display-4"></i>
                            <p class="mb-0 small">Upload banner (Max: 5MB, Min: 1280x480, 16:6)</p>
                        </div>

                        <!-- Hidden file input -->
                        <input type="file" class="d-none" (change)="onCoverUpload($event)" #coverFileInput
                            accept="image/*" />
                    </div>

                    <!-- Remove button -->
                    <i *ngIf="showCoverBox" class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                        style="cursor:pointer; font-size:1.5rem;" (click)="clearCoverImage()"></i>

                    <!-- Validation message -->
                    <div class="mt-2"
                        *ngIf="BookReviewsForm.get('coverImage')?.invalid && BookReviewsForm.get('coverImage')?.touched">
                        <p class="error-msg2">Banner image is required!</p>
                    </div>
                </div>


                <!-- Title -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Title <span class="required">*</span></label>
                    <input type="text" class="form-control" formControlName="storyTitle" placeholder="Enter title">
                    <div
                        *ngIf="BookReviewsForm.get('storyTitle')?.invalid && BookReviewsForm.get('storyTitle')?.touched">
                        <p class="error-msg2">Title is required!</p>
                    </div>
                </div>

                <!-- Story Content -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Review Content <span class="required">*</span></label>
                    <div class="quill-wrapper" style="height: 400px; width: 100%;">
                        <quill-editor formControlName="storyContent" [style]="{height: '100%', width: '100%'}"
                            theme="snow"></quill-editor>
                    </div>
                    <div
                        *ngIf="BookReviewsForm.get('storyContent')?.invalid && BookReviewsForm.get('storyContent')?.touched">
                        <p class="error-msg2">Review is required!</p>
                    </div>
                </div>


                <!-- Book CoverImage -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">
                        Book Cover Image <span class="required">*</span>
                    </label> <br>
                    <small class="text-muted">Recommended cover size: 400Ã—600 px (2:3 aspect ratio)</small>


                    <!-- Book cover card (portrait style) -->
                    <div class="img-card card p-3" style="width: 200px; height: 300px;">
                        <!-- Upload button -->
                        <div *ngIf="!showStoryImgBox" class="d-flex align-items-center justify-content-center h-100">
                            <button type="button" class="btn btn-outline-secondary w-100"
                                (click)="storyImgInput.click()">Choose Image</button>
                            <input type="file" class="d-none" (change)="onStoryImageUpload($event)" #storyImgInput
                                accept="image/*" />
                        </div>

                        <!-- Preview box -->
                        <div *ngIf="showStoryImgBox" class="position-relative w-100 h-100">
                            <img *ngIf="storyFileType?.startsWith('image/')" [src]="storyImgPreview"
                                class="img-preview img-fluid rounded"
                                style="width: 100%; height: 100%; object-fit: contain;" />
                            <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                                (click)="clearStoryImage()" style="cursor: pointer;"></i>
                        </div>
                    </div>

                    <!-- Validation -->
                    <div
                        *ngIf="BookReviewsForm.get('storyImage')?.invalid && BookReviewsForm.get('storyImage')?.touched">
                        <p class="error-msg2">Book cover image is required!</p>
                    </div>
                </div>



                <div class="mb-3">
                    <label class="form-label fw-semibold">Book Rating <span class="required">*</span></label>
                    <div class="star-rating">
                        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                            <i class="bi" [ngClass]="{
          'bi-star-fill': BookReviewsForm.get('bookRating')?.value >= star,
          'bi-star': BookReviewsForm.get('bookRating')?.value < star
        }" (click)="setRating(star)" style="font-size: 1.5rem; cursor: pointer; color: gold;"></i>
                        </ng-container>
                        <!-- <div
                            *ngIf="BookReviewsForm.get('bookRating')?.invalid && BookReviewsForm.get('bookRating')?.touched">
                            <p class="error-msg2">Rating is required!</p>
                        </div> -->
                    </div>
                </div>


            </div>
        </form>

        <div class="text-end mt-3">
            <button type="button" class="btn save-btn" (click)="handleBookreviews()">Save</button>
        </div>

    </div>


</div>

<div *ngIf="Loader" class="spinner-container">
    <div class="spinner"></div>
</div>