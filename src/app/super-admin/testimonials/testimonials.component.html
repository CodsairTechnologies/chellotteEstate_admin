<div class="p-3">
  <div class="row first-row mb-2">
    <!-- breadcrumbs -->
    <div class="col">
      <div class="breadcrumb">
        <span class="home-icon"><i class="bi bi-house-fill"></i></span>
        <a href="/super-admin/testimonials" class="breadcrumb-item">Testimonials</a>
      </div>
    </div>

    <!-- button -->
    <div class="col">
      <div class="justify-content-end d-flex">
        <button pButton type="button" label="+Add" class="btn button" (click)="openTestimonialModal(false)"></button>
      </div>
    </div>
  </div>

  <!-- table -->
  <div class="card table-card mb-3">
    <app-table
      [arrList]="arrList"
      [arrColumns]="arrColumns"
      [blnForDelete]="blnForDelete"
      [blnNoEdit]="blnNoEdit"
      [blnHasSingleview]="blnHasSingleview"
      (objPresentationEvent)="eventFromTable($event)">
    </app-table>
  </div>
</div>

<!-- ADD / EDIT MODAL -->
<p-dialog [(visible)]="openModal" [modal]="true" [style]="{ width: '40vw' }" [baseZIndex]="9000" [draggable]="false" [resizable]="false" [header]="modalHeader">
  <div class="modal-body">
    <form [formGroup]="TestimonialForm">
      <!-- Profile Image -->
      <div class="mb-3">
        <label class="form-label">Upload Profile Image <span class="required">*</span></label><br>
        <!-- <small class="text-muted">Recommended size: 300 Ã— 300 px (Max: 2MB)</small> -->

        <div class="img-card card mt-2">
          <div *ngIf="!showImageBox">
            <button type="button" class="btn uploadbtn" (click)="selectfile.click()">Choose File</button>
            <input type="file" class="form-control d-none" (change)="onFileUpload($event)" #selectfile accept="image/*">
          </div>

          <div *ngIf="showImageBox" class="img-div position-relative w-100">
            <img *ngIf="fileType?.startsWith('image/')" [src]="imagePreview" class="img-preview img-fluid w-100" />
            <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger" style="cursor: pointer;" (click)="clearCard()"></i>
          </div>
        </div>

        <div class="error-msg2 mt-2" *ngIf="TestimonialForm.get('profile_image')?.invalid && TestimonialForm.get('profile_image')?.touched">
          <p class="error-msg2">Profile image is required!</p>
        </div>
      </div>

      <!-- Name -->
      <div class="mb-3">
        <label class="form-label">Customer Name <span class="required">*</span></label>
        <input type="text" class="form-control" formControlName="name" placeholder="Enter customer name" />
        <div *ngIf="TestimonialForm.get('name')?.touched">
          <p class="error-msg2" *ngIf="TestimonialForm.get('name')?.errors?.['required']">Name is required!</p>
          <p class="error-msg2" *ngIf="TestimonialForm.get('name')?.errors?.['maxlength']">Maximum 50 characters allowed!</p>
        </div>
      </div>

      <!-- Testimony -->
      <div class="mb-3">
        <label class="form-label">Testimony <span class="required">*</span></label>
        <textarea class="form-control" formControlName="testimony" placeholder="Enter testimony" rows="3"></textarea>
        <div *ngIf="TestimonialForm.get('testimony')?.touched">
          <p class="error-msg2" *ngIf="TestimonialForm.get('testimony')?.errors?.['required']">Testimony is required!</p>
          <p class="error-msg2" *ngIf="TestimonialForm.get('testimony')?.errors?.['maxlength']">Maximum 200 characters allowed!</p>
        </div>
      </div>
    </form>
  </div>

  <ng-template pTemplate="footer">
    <button type="submit" pButton (click)="handleTestimonialOperation()" class="submit-btn">Save</button>
  </ng-template>
</p-dialog>

<!-- Single View Modal -->
<p-dialog
  [(visible)]="displaySingleViewModal"
  header="Testimonial Details"
  [modal]="true"
  [style]="{ width: '50vw' }"
  [closable]="true"
  [dismissableMask]="true"
>
  <div *ngIf="selectedTestimonial" class="singleview-body p-3">
    <!-- Profile Image -->
    <div class="text-center mb-3">
      <img
        [src]="getImageUrl(selectedTestimonial.profile_image)"
        alt="Profile Image"
        class="img-fluid singleview-image shadow-sm"
        width="150"
        height="150"
      />
    </div>

    <!-- Name -->
    <div class="form-group mb-3" *ngIf="selectedTestimonial.name">
      <label class="form-label fw-semibold">Customer Name</label>
      <p class="form-control-plaintext">{{ selectedTestimonial.name }}</p>
    </div>

    <!-- Testimonial -->
    <div class="form-group mb-3" *ngIf="selectedTestimonial.testimony">
      <label class="form-label fw-semibold">Testimonial</label>
      <p class="form-control-plaintext text-muted text-start" style="white-space: pre-wrap;">
        {{ selectedTestimonial.testimony }}
      </p>
    </div>
  </div>
</p-dialog>


<!-- Delete Modal -->
<p-dialog [(visible)]="deleteModal" [modal]="true" [style]="{ width: '35vw' }" [baseZIndex]="10000" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="header">
    <div class="d-flex align-items-center">
      <i class="bi bi-exclamation-triangle"></i>
      <span>Delete Testimonial</span>
    </div>
  </ng-template>

  <div>
    <p class="justify-content-center d-flex mt-3 delete-para">Are you sure you want to delete this testimonial?</p>
  </div>

  <ng-template pTemplate="footer">
    <div class="justify-content-center d-flex">
      <button type="button" pButton class="close-btn" (click)="deleteModal = false">Close</button>
      &nbsp;&nbsp;&nbsp;
      <button type="button" pButton class="delete-btn" (click)="deleteFn()">Delete</button>
    </div>
  </ng-template>
</p-dialog>

<div *ngIf="Loader" class="spinner-container">
  <div class="spinner"></div>
</div>
