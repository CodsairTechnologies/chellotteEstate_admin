<div class="p-3">
    <div class="row  first-row mb-2">
        <!-- breadcrumbs -->
        <div class="col">
            <div class="breadcrumb">
                <span class="home-icon"><i class="bi bi-house-fill"></i></span>
                <!-- <a href="/super-admin/Dashboard" class="breadcrumb-item">Dashboard</a>

                <span class="arrow-icon"><i class="bi bi-caret-right-fill"></i></span> -->
                <a href="/super-admin/listevents" class="breadcrumb-item">Events</a>


                <span class="arrow-icon"><i class="bi bi-caret-right-fill"></i></span>

                <a href="/super-admin/events" class="breadcrumb-item">
                    {{ isEditMode ? 'Edit Events' : 'Add Events' }}
                </a>
            </div>


        </div>
        <!-- breadcrumbs -->
    </div>

    <div class="card table-card mb-3 p-4 m-4 border rounded shadow-sm bg-white">
        <form [formGroup]="eventForm" enctype="multipart/form-data">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Event Title <span class="required">*</span></label>
                    <input type="text" class="form-control" formControlName="title" placeholder="Enter event title">
                    <div class="error-msg2" *ngIf="eventForm.get('title')?.invalid && eventForm.get('title')?.touched">
                        Event Title is required
                    </div>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Location <span class="required">*</span></label>
                    <input type="text" class="form-control" formControlName="location" placeholder="Event location">
                    <div class="error-msg2"
                        *ngIf="eventForm.get('location')?.invalid && eventForm.get('location')?.touched">
                        Location is required
                    </div>
                </div>
            </div>

            <div class="mb-3 w-75 position-relative">
                <label class="form-label">Banner Image</label>

                <!-- Upload card -->
                <div class="border rounded overflow-hidden" style="height: 200px; cursor: pointer;"
                    (click)="coverFileInput.click()">

                    <!-- Preview -->
                    <img *ngIf="showCoverBox" [src]="coverPreview" class="w-100 h-100 rounded"  style="object-fit: contain;"  />

                    <!-- Placeholder / instructions -->
                    <div *ngIf="!showCoverBox"
                        class="d-flex flex-column justify-content-center align-items-center h-100 text-muted">
                        <i class="bi bi-upload display-4"></i>
                        <p class="mb-0 small">Upload banner (Max: 5MB, Min: 1280x480, 16:6)</p>
                    </div>

                    <!-- Hidden file input -->
                    <input type="file" class="d-none" (change)="onBannerUpload($event)" #coverFileInput
                        accept="image/*" />
                </div>

                <!-- Remove button -->
                <i *ngIf="showCoverBox" class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                    style="cursor:pointer; font-size:1.5rem;" (click)="clearCoverImage()"></i>

                <!-- Validation message -->
                <div class="mt-2 error-msg2"
                    *ngIf="eventForm.get('bannerImage')?.invalid && eventForm.get('bannerImage')?.touched">
                    Banner image is required
                </div>
            </div>


            <div class="mb-3">
                <label class="form-label">Short Description <span class="required">*</span></label>
                <textarea class="form-control" rows="2" formControlName="shortDescription"></textarea>
                <div class="error-msg2"
                    *ngIf="eventForm.get('shortDescription')?.invalid && eventForm.get('shortDescription')?.touched">
                    Short description is required
                </div>


            </div>

            <div class="row mb-3">
                <div class="col-md-3">
                    <label class="form-label">From Date <span class="required">*</span></label>
                    <input type="date" class="form-control" formControlName="fromDate">
                    <div class="error-msg2"
                        *ngIf="eventForm.get('fromDate')?.invalid && eventForm.get('fromDate')?.touched">
                        Date is required
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">To Date</label>
                    <input type="date" class="form-control" formControlName="toDate">
                </div>
                <div class="col-md-3">
                    <label class="form-label">From Time <span class="required">*</span></label>
                    <input type="time" class="form-control" formControlName="fromTime">
                    <div class="error-msg2"
                        *ngIf="eventForm.get('fromTime')?.invalid && eventForm.get('fromTime')?.touched">
                        FromTime is required
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">To Time <span class="required">*</span></label>
                    <input type="time" class="form-control" formControlName="toTime">
                    <div class="error-msg2"
                        *ngIf="eventForm.get('toTime')?.invalid && eventForm.get('toTime')?.touched">
                        ToTime is required
                    </div>
                </div>
            </div>


            <div class="mb-3">
                <label class="form-label">Event Image <span class="required">*</span></label>
                <div class="img-card card p-3 w-75">
                    <div *ngIf="!showEventImageBox">
                        <button type="button" class="btn btn-outline-secondary w-100"
                            (click)="eventImgInput.click()">Choose Event Image</button>
                        <input type="file" class="d-none" (change)="onEventImageUpload($event)" #eventImgInput
                            accept="image/*" />
                    </div>
                    <div *ngIf="showEventImageBox" class="position-relative">
                        <img *ngIf="eventFileType.startsWith('image/')" [src]="eventImagePreview"
                            class="img-preview img-fluid rounded border" />
                        <i class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                            (click)="clearEventImage()" style="cursor: pointer;"></i>
                    </div>
                </div>
                <div class="error-msg2"
                    *ngIf="eventForm.get('eventImage')?.invalid && eventForm.get('eventImage')?.touched">
                    Event Image is required
                </div>
            </div>


            <div class="mb-3">
                <label class="form-label">Event Small Description <span class="required">*</span></label>
                <div class="quill-wrapper" style="height: 400px; width: 100%;">
                    <quill-editor formControlName="eventImageDescription" [style]="{height: '100%', width: '100%'}"
                        theme="snow"></quill-editor>
                </div>

                <div class="error-msg2"
                    *ngIf="eventForm.get('eventImageDescription')?.invalid && eventForm.get('eventImageDescription')?.touched">
                    Event description is required
                </div>


            </div>



            <div class="mb-3">
                <h6 class="section-title mb-3">Speakers</h6>

                <div class="speakers" formArrayName="speakers">
                    <div *ngFor="let speaker of speakers.controls; let i = index" [formGroupName]="i"
                        class="position-relative border p-3 rounded mb-2">
                        <!-- Close button -->
                        <button type="button"
                            class="custom-close-icon position-absolute btn btn-light p-0 d-flex justify-content-center align-items-center"
                            *ngIf="speakers.length > 1"
                            style="top: 10px; right: 10px; width: 30px; height: 30px; border-radius: 50%;"
                            (click)="removeSpeaker(i)">
                            &times;
                        </button>

                        <div class="row">
                            <!-- Speaker Image -->
                            <div class="col-auto mb-2 position-relative">
                                <label class="form-label fw-semibold">Speaker Image</label>

                                <!-- Upload card (square, left-aligned) -->
                                <div class="border rounded overflow-hidden text-center position-relative"
                                    style="width: 180px; height: 180px; cursor: pointer;"
                                    (click)="triggerSpeakerImageInput(i)">

                                    <!-- Preview -->
                                    <img *ngIf="speakerImagePreviews[i]" [src]="speakerImagePreviews[i]"
                                        class="w-100 h-100 object-fit-cover rounded" />

                                    <!-- Placeholder / instructions -->
                                    <div *ngIf="!speakerImagePreviews[i]"
                                        class="d-flex flex-column justify-content-center align-items-center h-100 text-muted text-center">
                                        <!-- Reduced icon size and weight -->
                                        <i class="bi bi-upload mb-2" style="font-size: 2rem; font-weight: 400;"></i>
                                        <p class="mb-0 small" style="font-size: 0.75rem;">
                                            Upload speaker image<br>
                                            (Max: 5MB, Square, Min: 180×180 px)
                                        </p>
                                    </div>

                                    <!-- Hidden file input -->
                                    <input type="file" class="d-none" [id]="'speakerImageInput' + i"
                                        (change)="onSpeakerImageChange($event, i)" accept="image/*" />

                                    <!-- Remove button -->
                                    <i *ngIf="speakerImagePreviews[i]"
                                        class="bi bi-x-circle-fill position-absolute top-0 end-0 text-danger"
                                        style="cursor:pointer; font-size:1.5rem;"
                                        (click)="speakerImagePreviews[i] = null; speakers.at(i).patchValue({ speakerphoto: null });">
                                    </i>
                                </div>
                            </div>

                            <!-- Name and Job -->
                            <div class="col">
                                <div class="mb-2">
                                    <label class="form-label">Name</label>
                                    <input formControlName="name" type="text" class="form-control"
                                        placeholder="Enter speaker name" />
                                </div>
                                <div>
                                    <label class="form-label">Job</label>
                                    <input formControlName="job" type="text" class="form-control"
                                        placeholder="Enter speaker job" />
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <button type="button" class="btn btn-secondary" (click)="addSpeaker()">+ Add Speaker</button>
            </div>



            <div class="mb-3">
                <h6 class="section-title mb-3">Gallery Images</h6>

                <!-- Drag and Drop Area with Upload Link -->
                <div class="drop-area" (dragover)="onDragOver($event)" (drop)="onDrop($event)"
                    (click)="triggerFileInput()">
                    <a class="upload-link">Click to Upload</a>
                    <p>or Drag & Drop Images Here</p>
                    <!-- Rename this to avoid conflict -->
                    <input type="file" #galleryFileInput multiple (change)="onFileSelect($event)" hidden>

                </div>

                <!-- Image Preview Section with Remove Button -->
                <div class="image-preview1" *ngIf="imagePreviews.length > 0">
                    <div class="preview-container" *ngFor="let img of imagePreviews; let i = index">
                        <img [src]="img" class="preview-img">
                        <button class="remove-btn" (click)="removeImage(i)">X</button>
                    </div>
                </div>

            </div>

        </form>


        <div class="text-end mt-3">
            <button type="button" class="btn save-btn" (click)="handleEventsubmit()">Save</button>
        </div>
    </div>
</div>

<div *ngIf="Loader" class="spinner-container">
    <div class="spinner"></div>
</div>